<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PVV Standpunten Viewer</title>

    <!-- SwiperJS CSS from CDN -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css" />
    <!-- Tailwind CSS from CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts for a cleaner look -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">

    <style>
		/* A simplified style block. All styling is now applied directly to the slide. */
		.swiper-slide-active {
			transform: scale(1.05);
			background-color: #60a5fa !important; /* Tailwind's blue-400 to match the title */
			color: #ffffff !important;
			box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1), 0 4px 6px -4px rgb(0 0 0 / 0.1);
			opacity: 1 !important;
		}
		/* Ensure slides that are not active are slightly faded for focus */
		.swiper-slide:not(.swiper-slide-active) {
			opacity: 0.6;
		}
		/* Custom class for line clamping */
		.line-clamp-2 {
			overflow: hidden;
			display: -webkit-box;
			-webkit-box-orient: vertical;
			-webkit-line-clamp: 2;
		}
    </style>
</head>
<body class="bg-gray-900 font-sans flex items-center justify-center min-h-screen p-4">

<div class="bg-gray-800 text-gray-200 rounded-2xl shadow-xl p-4 sm:p-6 w-full max-w-6xl h-[92vh] flex flex-col">
    <h1 class="text-2xl md:text-3xl font-bold text-center text-blue-400 mb-4">PVV Standpunten: Belofte vs. Realiteit</h1>
    <p class="text-center mb-6 text-sm">Bron: <a class="text-blue-400 hover:underline font-bold" href="https://docs.google.com/spreadsheets/d/e/2PACX-1vSTMkodFf4rovfruXnneVbynlPBYlfXq-RxJ_O1g_EL0xlcSyB1WHjuMet3IrGZCiPX9Qrq20eM9ACT/pubhtml?gid=0&single=true" target="_blank">Ton Aarts</a></p>
    <!-- Content wrapper: flex-col on mobile, flex-row on desktop -->
    <div class="flex flex-col md:flex-row w-full flex-grow gap-4 overflow-hidden">

        <!-- Swiper Column -->
        <div class="bg-white border border-gray-700 rounded-xl p-3 flex flex-col md:w-1/2 h-72 md:h-full">
            <h2 class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-3 flex-shrink-0">Scroll of klik op een standpunt</h2>
            <div class="relative flex-grow min-h-0">
                <div class="swiper swiper-container h-full">
                    <div class="swiper-wrapper">
                        <!-- Slides will be dynamically loaded here by JavaScript -->
                    </div>
                </div>
                <!-- Fade effect overlays -->
                <div class="absolute top-0 left-0 right-0 h-10 bg-gradient-to-b from-white to-transparent z-10 pointer-events-none"></div>
                <div class="absolute bottom-0 left-0 right-0 h-10 bg-gradient-to-t from-white to-transparent z-10 pointer-events-none"></div>
            </div>
        </div>

        <!-- Answer Column -->
        <div class="bg-white border border-gray-700 rounded-xl p-5 flex flex-col md:w-1/2 flex-grow">
            <h2 id="antwoord-titel" class="text-lg font-semibold text-gray-900 border-b border-gray-200 pb-2 mb-4 flex-shrink-0">Standpunt wordt geladen...</h2>
            <div class="flex-grow overflow-y-auto pr-2">
                <p class="text-xs text-gray-500 mb-2 uppercase font-semibold">Wat gebeurde er?</p>
                <div id="antwoord-tekst" class="text-gray-800 leading-relaxed text-base md:text-lg">
                    <p>Laden van de data...</p>
                </div>
            </div>
            <div id="bron-container" class="mt-4 pt-4 border-t border-gray-200 flex-shrink-0">
                <!-- Source will be dynamically loaded here -->
            </div>
        </div>
    </div>
</div>

<!-- SwiperJS JS from CDN -->
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>

<script>
    document.addEventListener('DOMContentLoaded', async () => {
        const sheetUrl = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vSTMkodFf4rovfruXnneVbynlPBYlfXq-RxJ_O1g_EL0xlcSyB1WHjuMet3IrGZCiPX9Qrq20eM9ACT/pub?gid=0&single=true&output=csv';
        const swiperWrapper = document.querySelector('.swiper-wrapper');
        const antwoordTekst = document.getElementById('antwoord-tekst');
        const bronContainer = document.getElementById('bron-container');
        const antwoordTitel = document.getElementById('antwoord-titel');


        try {
            const response = await fetch(sheetUrl);
            if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);

            const csvText = await response.text();
            const data = parseCSV(csvText);

            const standpuntIndex = 1; // Column 2
            const antwoordIndex = 2;  // Column 3
            const bronIndex = 3;      // Column 4

            const cleanData = data.rows.filter(row => row.length > standpuntIndex && row[standpuntIndex] && row[standpuntIndex].trim() !== '');

            if (cleanData.length === 0) {
                throw new Error('Geen geldige standpunten gevonden in het document.');
            }

            cleanData.forEach(row => {
                const slide = document.createElement('div');
                // FIX: Removed line-clamp from the main div and wrapped the text in a <p> with the class.
                slide.className = 'swiper-slide h-24 flex-shrink-0 flex items-center justify-center text-center p-4 bg-gray-200 text-gray-800 rounded-lg transition-all duration-300 font-medium cursor-pointer';
                slide.innerHTML = `<p class="line-clamp-2">${row[standpuntIndex]}</p>`;
                swiperWrapper.appendChild(slide);
            });

            const swiper = new Swiper('.swiper', {
                direction: 'vertical',
                initialSlide: Math.floor(Math.random() * 300),
                slidesPerView: 3,
                breakpoints: {
                    1024: {
                        slidesPerView: 5, // Made slightly more compact on large screens
                    },
                },
                spaceBetween: 15,
                centeredSlides: true,
                loop: true,
                freeMode: {
                    enabled: true,
                    sticky: true,
                },
                mousewheel: true,
            });

            const updateAntwoord = () => {
                const activeIndex = swiper.realIndex;
                const standpuntText = cleanData[activeIndex][standpuntIndex];
                const antwoordHTML = cleanData[activeIndex][antwoordIndex] || 'Geen data beschikbaar voor dit standpunt.';
                const bronText = cleanData[activeIndex][bronIndex];

                antwoordTitel.textContent = standpuntText;
                antwoordTekst.innerHTML = antwoordHTML;

                bronContainer.innerHTML = ''; // Clear previous source
                if (bronText && bronText.trim()) {
                    let bronHTML = `<h3 class="text-md font-semibold text-gray-900 mb-2">Bron:</h3>`;
                    if (bronText.trim().startsWith('http')) {
                        bronHTML += `<a href="${bronText}" target="_blank" rel="noopener noreferrer" class="text-blue-600 hover:underline break-all">${bronText}</a>`;
                    } else {
                        bronHTML += `<p class="text-gray-700">${bronText}</p>`;
                    }
                    bronContainer.innerHTML = bronHTML;
                }
            };

            swiper.on('transitionEnd', updateAntwoord);

            swiper.on('click', (swiper, event) => {
                const clickedSlide = event.target.closest('.swiper-slide');
                if (clickedSlide && !clickedSlide.classList.contains('swiper-slide-active')) {
                    const slideIndex = parseInt(clickedSlide.dataset.swiperSlideIndex, 10);
                    swiper.slideToLoop(slideIndex);
                }
            });

            updateAntwoord();

        } catch (error) {
            console.error('Fout bij het laden van de data:', error);
            antwoordTekst.innerHTML = `<p class="text-red-600"><strong>Fout:</strong> Kon de data niet laden. Controleer de link van het Google Sheet en of het correct is gepubliceerd.</p><p class="text-sm text-red-400">${error.message}</p>`;
        }
    });

    function parseCSV(text) {
        const lines = text.split(/\r\n|\n/).filter(line => line);
        const headers = lines[0].split(',').map(header => header.trim().replace(/^"|"$/g, ''));
        const rows = lines.slice(1).map(line => {
            const row = [];
            const regex = /("([^"]|"")*"|[^,]*)(,|$)/g;
            let match;
            let lineToParse = line;
            while ((match = regex.exec(lineToParse))) {
                let value = match[1];
                if (value.startsWith('"') && value.endsWith('"')) {
                    value = value.slice(1, -1).replace(/""/g, '"');
                }
                row.push(value);
                if (match[0] === '' || regex.lastIndex === 0) break;
            }
            return row;
        });
        return { headers, rows };
    }
</script>
</body>
</html>

